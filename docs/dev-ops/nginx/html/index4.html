<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>深圳市重大科技基础设施和大型科研仪器共享平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=2DrlbRGZL9P8sROU9EBGBOb3DAHyHx2i"></script>
    <style>
        /* 修复搜索按钮对齐问题 */
        .search-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-row {
            display: flex;
            align-items: center; /* 确保垂直居中对齐 */
            gap: 0.5rem;
        }

        .search-row select,
        .search-row input,
        .search-row button {
            height: 2.5rem; /* 统一高度 */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-row input {
            padding: 0 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }

        .search-row button {
            padding: 0 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }

        .search-row button svg {
            width: 1.25rem;
            height: 1.25rem;
        }

        /* 侧边栏切换动画 */
        .sidebar {
            transition: margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 0;
        }

        .sidebar.collapsed {
            margin-right: -24rem; /* w-96 is 24rem */
        }

        /* 修改切换按钮样式 */
        .toggle-btn {
            position: absolute;
            right: 10px;
            top: 10px;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: scale(1.05);
        }

        .toggle-btn svg {
            transition: transform 0.3s ease;
        }

        .toggle-btn.collapsed svg {
            transform: rotate(180deg);
        }

        /* 地图容器调整 */
        .map-section {
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 自定义信息窗口样式 */
        .custom-info-window {
            max-width: 300px;
            padding: 15px;
            position: relative;
        }

        /* 自定义关闭按钮样式 */
        .info-window-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
            z-index: 1000;
        }

        .info-window-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .info-window-close:active {
            transform: scale(0.95);
        }

        /* 移动端信息窗口优化 */
        @media (max-width: 768px) {
            .custom-info-window {
                max-width: 280px;
                padding: 12px;
                font-size: 14px;
            }

            .info-window-close {
                width: 28px;
                height: 28px;
                font-size: 16px;
                top: 5px;
                right: 5px;
            }

            .custom-info-window h4 {
                font-size: 16px;
                margin-bottom: 8px;
                padding-right: 35px;
            }

            .custom-info-window p {
                font-size: 13px;
                margin-bottom: 6px;
            }

            .custom-info-window img {
                height: 120px;
                margin-top: 8px;
            }
        }

        /* 仪器标记样式 */
        .instrument-marker {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        /* 自定义HTML标记样式 */
        .custom-marker {
            width: 30px;
            height: 30px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .custom-marker.small {
            width: 20px;
            height: 20px;
            font-size: 10px;
        }

        .custom-marker.large {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }

        .custom-marker.xlarge {
            width: 50px;
            height: 50px;
            font-size: 16px;
        }

        /* 悬停效果 */
        .custom-marker:hover {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }

        /* 定位针样式 */
        .location-pin {
            width: 30px;
            height: 40px;
            position: relative;
            background: #dc2626;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .location-pin::after {
            content: '';
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .location-pin .pin-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            color: #dc2626;
            font-weight: bold;
            font-size: 12px;
            z-index: 1;
        }

        /* 搜索结果高亮样式 */
        .search-highlight {
            background-color: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 增强的分页样式 */
        .pagination-container {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-top: 1px solid #e2e8f0;
            backdrop-filter: blur(10px);
        }

        .pagination-info {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .pagination-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            height: 40px;
            padding: 0 12px;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            user-select: none;
            overflow: hidden;
        }

        .pagination-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .pagination-btn:hover::before {
            opacity: 1;
        }

        .pagination-btn-default {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: #475569;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
        }

        .pagination-btn-default:hover:not(:disabled) {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-color: #cbd5e1;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .pagination-btn-active {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: 1px solid #dc2626;
            box-shadow: 0 4px 6px rgba(220, 38, 38, 0.3), 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .pagination-btn-active:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(220, 38, 38, 0.4), 0 3px 6px rgba(220, 38, 38, 0.3);
        }

        .pagination-btn:disabled {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: #94a3b8;
            border-color: #e2e8f0;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .pagination-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* 分页按钮图标动画 */
        .pagination-icon {
            transition: transform 0.2s ease;
        }

        .pagination-btn:hover .pagination-icon {
            transform: scale(1.1);
        }

        /* 页面切换动画 */
        .page-transition {
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 分页容器动画 */
        .pagination-wrapper {
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式分页 */
        @media (max-width: 640px) {
            .pagination-btn {
                min-width: 36px;
                height: 36px;
                padding: 0 8px;
                font-size: 0.8rem;
            }

            .pagination-info {
                font-size: 0.8rem;
            }
        }

        /* 分页加载状态 */
        .pagination-loading {
            position: relative;
            pointer-events: none;
        }

        .pagination-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* 分页数字跳动效果 */
        .pagination-number-bounce {
            animation: numberBounce 0.3s ease-out;
        }

        @keyframes numberBounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* 移动端适配样式 */
        @media (max-width: 768px) {
            /* 头部适配 */
            header .container {
                padding: 0.5rem 1rem;
            }

            header h1 {
                font-size: 1rem;
                display: none; /* 在手机上隐藏长标题 */
            }

            header .flex {
                flex-direction: column;
                gap: 0.5rem;
            }

            header .flex:first-child {
                flex-direction: row;
                justify-content: space-between;
                width: 100%;
            }

            /* 显示简化标题 */
            .mobile-title {
                display: block;
                font-size: 0.9rem;
                font-weight: 600;
            }

            /* 搜索区域适配 */
            .search-container {
                flex-direction: column;
                width: 100%;
                gap: 0.5rem;
            }

            .search-row {
                display: flex;
                gap: 0.5rem;
                width: 100%;
            }

            .search-row input {
                flex: 1;
                min-width: 0;
            }

            .search-row button {
                flex-shrink: 0;
            }

            /* 导航标签适配 */
            nav .container {
                padding: 0 1rem;
            }

            nav .flex {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            nav button {
                white-space: nowrap;
                flex-shrink: 0;
            }

            /* 主布局适配 */
            .main-container {
                flex-direction: column;
                height: calc(100vh - 120px); /* 调整高度以适应头部 */
            }

            /* 地图容器适配 */
            .map-section {
                height: 50vh;
                position: relative;
            }

            /* 侧边栏适配 */
            .sidebar {
                width: 100%;
                height: 50vh;
                max-height: none;
                border-radius: 1rem 1rem 0 0;
                position: relative;
            }

            .sidebar::before {
                content: '';
                position: absolute;
                top: 0.5rem;
                left: 50%;
                transform: translateX(-50%);
                width: 2rem;
                height: 0.25rem;
                background: #cbd5e1;
                border-radius: 0.125rem;
                z-index: 10;
            }

            /* 移动端隐藏切换按钮 */
            .toggle-btn {
                display: none;
            }

            /* 侧边栏头部适配 */
            .sidebar-header {
                padding: 1rem 3rem 0.5rem 1rem;
                position: sticky;
                top: 0;
                background: #dbeafe;
                z-index: 5;
            }

            .sidebar-header h3 {
                font-size: 0.9rem;
            }

            /* 列表项适配 */
            .instrument-item {
                padding: 0.75rem 1rem;
            }

            .instrument-item h4 {
                font-size: 0.875rem;
            }

            .instrument-item p {
                font-size: 0.8rem;
            }

            .instrument-item .text-xs {
                font-size: 0.75rem;
            }

            /* 分页适配 */
            .pagination-container {
                padding: 1rem;
                position: sticky;
                bottom: 0;
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                border-top: 2px solid #e2e8f0;
                box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.05);
            }

            .pagination-wrapper {
                gap: 0.75rem;
            }

            .pagination-info {
                font-size: 0.75rem;
                text-align: center;
                order: 2;
            }

            .pagination-controls {
                order: 1;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .pagination-btn {
                min-width: 36px;
                height: 36px;
                padding: 0 8px;
                font-size: 0.8rem;
            }

            /* 隐藏部分分页按钮在极小屏幕上 */
            .pagination-btn.hide-mobile {
                display: none;
            }

            /* 搜索状态提示适配 */
            #searchStatus {
                top: 1rem;
                left: 1rem;
                right: 1rem;
                width: auto;
            }

            /* 无结果页面适配 */
            .no-results {
                padding: 2rem 1rem;
            }

            .no-results svg {
                width: 3rem;
                height: 3rem;
            }

            .no-results h3 {
                font-size: 1rem;
            }

            .no-results p {
                font-size: 0.875rem;
            }
        }

        /* 超小屏幕适配 */
        @media (max-width: 480px) {
            .pagination-btn {
                min-width: 32px;
                height: 32px;
                font-size: 0.75rem;
            }

            .pagination-info {
                font-size: 0.7rem;
            }

            /* 进一步简化分页 */
            .pagination-ellipsis {
                display: none;
            }

            /* 只显示关键按钮 */
            .pagination-btn:not(.pagination-btn-active):not([title="上一页"]):not([title="下一页"]) {
                display: none;
            }

            .pagination-btn[title="首页"],
            .pagination-btn[title="尾页"] {
                display: none;
            }
        }

        /* 横屏手机适配 */
        @media (max-width: 768px) and (orientation: landscape) {
            .main-container {
                flex-direction: row;
                height: 100vh;
            }

            .map-section {
                height: 100vh;
                width: 60%;
            }

            .sidebar {
                width: 40%;
                height: 100vh;
                border-radius: 0;
            }

            .sidebar::before {
                display: none;
            }
        }

        /* 触摸优化 */
        @media (hover: none) and (pointer: coarse) {
            .pagination-btn:hover {
                transform: none;
            }

            .pagination-btn:active {
                transform: scale(0.95);
            }

            .instrument-item:hover {
                background-color: transparent;
            }

            .instrument-item:active {
                background-color: #f9fafb;
            }
        }

        /* 收起状态下的浮动按钮 */
        .floating-toggle-btn {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .floating-toggle-btn:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            transform: translateY(-50%) scale(1.1);
        }

        .floating-toggle-btn.show {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-50">
<!-- 页面头部 -->
<header class="bg-gradient-to-r from-blue-900 to-blue-700 text-white">
    <div class="container mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-8"><img src="https://irshare.cn/v2_admin/assets/logo-Cl7vc8V9.png" alt="平台Logo"/></div>
                <h1 class="text-xl font-bold hidden md:block">深圳市重大科技基础设施和大型科研仪器共享平台</h1>
                <h1 class="mobile-title md:hidden">深圳科研仪器平台</h1>
            </div>
            <button class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-sm md:hidden" onclick="toggleMobileMenu()">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
        <div class="search-container mt-2 md:mt-0 md:flex md:items-center md:space-x-4" id="mobileMenu">
            <div class="search-row">
                <select class="bg-blue-600 text-white px-3 py-1 rounded border-none flex-shrink-0">
                    <option>大型仪器</option>
                </select>
                <input type="text" placeholder="请输入关键词" class="px-3 py-1 rounded text-gray-800 flex-1" id="searchInput">
                <button class="bg-blue-500 hover:bg-blue-600 px-4 py-1 rounded flex items-center justify-center" onclick="searchInstruments()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
            <div class="search-row mt-2 md:mt-0">
                <button class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm" onclick="clearSearch()">清除</button>
                <button class="bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded text-sm">返回首页</button>
            </div>
        </div>
    </div>
</header>

<!-- 导航标签 -->
<nav class="bg-white shadow-sm border-b">
    <div class="container mx-auto px-4">
        <div class="flex space-x-8">
            <button class="py-3 px-4 text-red-500 border-b-2 border-red-500 font-medium">全部</button>
            <button class="py-3 px-4 text-gray-600 hover:text-blue-600">深圳市（<span id="shenzhenCount">9</span> 台）</button>
        </div>
    </div>
</nav>

<!-- 主要内容区域 -->
<div class="flex h-screen main-container">
    <!-- 地图容器 -->
    <div class="flex-1 relative map-section" id="mapSection">
        <div id="mapContainer" class="w-full h-full"></div>
        <!-- 搜索状态提示 -->
        <div id="searchStatus" class="absolute top-4 left-4 bg-white px-4 py-2 rounded-lg shadow-lg hidden">
            <div class="flex items-center space-x-2">
                <div class="loading"></div>
                <span>正在搜索仪器...</span>
            </div>
        </div>
    </div>

    <!-- 侧边栏 -->
    <div class="w-96 bg-white shadow-lg overflow-y-auto sidebar relative" id="sidebar">
        <!-- 切换按钮 -->
        <button class="toggle-btn" id="toggleBtn" onclick="toggleSidebar()" title="收起/展开列表">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
        </button>

        <div class="p-4 border-b bg-blue-50 sidebar-header">
            <div class="flex items-center justify-between">
                <h3 class="font-semibold text-gray-800">共找到 <span id="totalCount" class="text-blue-600">9</span> 台仪器</h3>
                <div id="searchInfo" class="text-sm text-gray-500 hidden">
                    搜索: "<span id="searchTerm" class="font-medium"></span>"
                </div>
            </div>
        </div>

        <div id="instrumentList" class="divide-y divide-gray-200">
            <!-- 仪器列表项将通过JavaScript动态生成 -->
        </div>

        <!-- 增强的分页控件容器 -->
        <div class="pagination-container">
            <div class="pagination-wrapper">
                <!-- 分页内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
</div>

<!-- 在</body>标签前添加浮动切换按钮 -->
<button class="floating-toggle-btn" id="floatingToggleBtn" onclick="toggleSidebar()" title="展开列表">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
    </svg>
</button>

<script>
    // 仪器数据样本 - 扩展更多数据用于演示分页效果
    const instrumentsData = [
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9a",
            "instrName": "热重分析仪",
            "companyName": "清华大学深圳国际研究生院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.060535",
            "latitude": "22.508943",
            "latitude_longitude": "114.060535 22.508943",
            "function": null,
            "placeProduce": "美国",
            "area": null,
            "address": "广东省深圳市南山区深圳市南山区西丽大学城清华大学深圳国际研究生院能源环境大楼18楼",
            "image": "https://www.irshare.cn/Sz_dxyq/fileAction/viewFile/9383cc0a-50a2-4063-9334-b1b1c7989a94",
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 9
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9b",
            "instrName": "激光芯片共晶贴片机",
            "companyName": "深圳清华大学研究院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "工艺试验仪器",
            "longitude": "113.994722",
            "latitude": "22.526455",
            "latitude_longitude": "113.994722 22.526455",
            "function": null,
            "placeProduce": "瑞士",
            "area": null,
            "address": "广东省深圳市龙华区广东省深圳市龙华区德泰科技工业园10号厂房2楼",
            "image": "https://www.irshare.cn/Sz_dxyq/fileAction/viewFile/166ee12f-69b0-408a-a7b9-889272a6150c",
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 8
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9c",
            "instrName": "扫描电子显微镜",
            "companyName": "深圳大学",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.058868",
            "latitude": "22.533099",
            "latitude_longitude": "114.058868 22.533099",
            "function": null,
            "placeProduce": "德国",
            "area": null,
            "address": "广东省深圳市南山区深圳大学城深圳大学材料学院",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 7
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9d",
            "instrName": "X射线衍射仪",
            "companyName": "南方科技大学",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "113.995722",
            "latitude": "22.596455",
            "latitude_longitude": "113.995722 22.596455",
            "function": null,
            "placeProduce": "日本",
            "area": null,
            "address": "广东省深圳市南山区学苑大道1088号南方科技大学",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 6
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9e",
            "instrName": "原子力显微镜",
            "companyName": "哈尔滨工业大学深圳研究生院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.055535",
            "latitude": "22.588943",
            "latitude_longitude": "114.055535 22.588943",
            "function": null,
            "placeProduce": "美国",
            "area": null,
            "address": "广东省深圳市南山区西丽深圳大学城哈尔滨工业大学深圳研究生院",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 5
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9f",
            "instrName": "高分辨透射电镜",
            "companyName": "深圳先进技术研究院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.025722",
            "latitude": "22.586455",
            "latitude_longitude": "114.025722 22.586455",
            "function": null,
            "placeProduce": "美国",
            "area": null,
            "address": "广东省深圳市南山区西丽深圳湾科技生态园",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 4
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9g",
            "instrName": "激光拉曼光谱仪",
            "companyName": "深圳职业技术学院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.125722",
            "latitude": "22.706455",
            "latitude_longitude": "114.125722 22.706455",
            "function": null,
            "placeProduce": "英国",
            "area": null,
            "address": "广东省深圳市南山区留仙大道7098号深圳职业技术学院",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 3
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9h",
            "instrName": "核磁共振波谱仪",
            "companyName": "深圳信息职业技术学院",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.235722",
            "latitude": "22.726455",
            "latitude_longitude": "114.235722 22.726455",
            "function": null,
            "placeProduce": "德国",
            "area": null,
            "address": "广东省深圳市龙岗区龙翔大道2188号深圳信息职业技术学院",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 2
        },
        {
            "id": "02e9e037af8d4f37b9dcf0f4ec725c9i",
            "instrName": "质谱联用仪",
            "companyName": "深圳技术大学",
            "province": "广东省",
            "city": "深圳市",
            "instrNumber": null,
            "instrSort": "分析仪器",
            "longitude": "114.045722",
            "latitude": "22.696455",
            "latitude_longitude": "114.045722 22.696455",
            "function": null,
            "placeProduce": "美国",
            "area": null,
            "address": "广东省深圳市坪山区兰田路3002号深圳技术大学",
            "image": null,
            "videoUrl": null,
            "videoLinkUrl": null,
            "caseUrl": null,
            "searchOrder": 1
        }
    ];

    // 全局变量
    let map; // 百度地图实例
    let markers = []; // 地图标记数组
    let filteredData = instrumentsData; // 过滤后的数据
    let currentSearchTerm = ''; // 当前搜索关键词
    let isPageLoading = false; // 分页加载状态
    let currentInfoWindow = null; // 当前打开的信息窗口
    let isSidebarCollapsed = false; // 侧边栏收起状态

    // 分页相关变量
    let currentPage = 1; // 当前页码
    const itemsPerPage = 4; // 每页显示条数

    /**
     * 切换侧边栏显示/隐藏
     */
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mapSection = document.getElementById('mapSection');
        const toggleBtn = document.getElementById('toggleBtn');
        const floatingBtn = document.getElementById('floatingToggleBtn');

        isSidebarCollapsed = !isSidebarCollapsed;

        if (isSidebarCollapsed) {
            // 收起侧边栏
            sidebar.classList.add('collapsed');
            toggleBtn.style.display = 'none';
            floatingBtn.classList.add('show');
            floatingBtn.title = '展开列表';
        } else {
            // 展开侧边栏
            sidebar.classList.remove('collapsed');
            toggleBtn.style.display = 'flex';
            floatingBtn.classList.remove('show');
            toggleBtn.title = '收起列表';
        }

        // 延迟调整地图大小，确保动画完成后再调整
        setTimeout(() => {
            if (map) {
                map.getContainer().style.width = '100%';
                map.getContainer().style.height = '100%';
                map.checkResize();
            }
        }, 300);
    }

    /**
     * 分页数据处理函数
     * @param {Array} data - 要分页的数据
     * @param {number} page - 页码
     * @param {number} itemsPerPage - 每页条数
     * @returns {Array} 当前页的数据
     */
    function paginateData(data, page, itemsPerPage) {
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        return data.slice(startIndex, endIndex);
    }

    /**
     * 获取总页数
     * @param {Array} data - 数据数组
     * @param {number} itemsPerPage - 每页条数
     * @returns {number} 总页数
     */
    function getTotalPages(data, itemsPerPage) {
        return Math.ceil(data.length / itemsPerPage);
    }

    /**
     * 关闭信息窗口
     */
    function closeInfoWindow() {
        if (currentInfoWindow) {
            map.closeInfoWindow();
            currentInfoWindow = null;
        }
    }

    /**
     * 初始化地图
     */
    function initMap() {
        // 创建地图实例
        map = new BMap.Map("mapContainer");
        // 设置地图中心为深圳市坐标，缩放级别为10
        map.centerAndZoom(new BMap.Point(114.057868, 22.543099), 10);
        // 启用鼠标滚轮缩放
        map.enableScrollWheelZoom(true);

        // 添加地图控件
        map.addControl(new BMap.NavigationControl()); // 导航控件
        map.addControl(new BMap.ScaleControl()); // 比例尺控件
        map.addControl(new BMap.OverviewMapControl()); // 缩略图控件

        // 监听地图点击事件，点击地图时关闭信息窗口
        map.addEventListener("click", function() {
            closeInfoWindow();
        });

        // 加载仪器到地图上
        loadInstruments();
    }

    /**
     * 加载仪器到地图上
     */
    function loadInstruments() {
        // 清除现有标记
        clearMarkers();

        // 遍历过滤后的数据，为每个仪器创建地图标记
        filteredData.forEach((instrument, index) => {
            if (instrument.longitude && instrument.latitude) {
                const point = new BMap.Point(parseFloat(instrument.longitude), parseFloat(instrument.latitude));

                // 创建定位针形状的SVG图标
                const icon = new BMap.Icon(
                    "data:image/svg+xml;base64," + btoa(`
                      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40">
                          <path d="M15 0C6.7 0 0 6.7 0 15c0 8.3 15 25 15 25s15-16.7 15-25C30 6.7 23.3 0 15 0z" fill="#dc2626" stroke="#ffffff" stroke-width="1"/>
                          <circle cx="15" cy="15" r="8" fill="#ffffff"/>
                          <text x="15" y="20" text-anchor="middle" fill="#dc2626" font-size="12" font-weight="bold">${index + 1}</text>
                      </svg>
                  `),
                    new BMap.Size(30, 40),
                    {
                        anchor: new BMap.Size(15, 40), // 图标锚点
                        imageOffset: new BMap.Size(0, 0) // 图像偏移
                    }
                );

                // 创建标记
                const marker = new BMap.Marker(point, { icon: icon });

                // 创建信息窗口内容（包含关闭按钮）
                const infoContent = `
                  <div class="custom-info-window">
                      <button class="info-window-close" onclick="closeInfoWindow()" title="关闭">
                          ×
                      </button>
                      <h4 class="font-bold text-blue-600 mb-2">${highlightSearchTerm(instrument.instrName, currentSearchTerm)}</h4>
                      <p class="text-sm text-gray-600 mb-1"><strong>单位：</strong>${highlightSearchTerm(instrument.companyName, currentSearchTerm)}</p>
                      <p class="text-sm text-gray-600 mb-1"><strong>地址：</strong>${instrument.address}</p>
                      <p class="text-sm text-gray-600 mb-1"><strong>类型：</strong>${highlightSearchTerm(instrument.instrSort, currentSearchTerm)}</p>
                      <p class="text-sm text-gray-600 mb-1"><strong>产地：</strong>${instrument.placeProduce}</p>
                      ${instrument.image ? `<img src="${instrument.image}" alt="${instrument.instrName}" class="w-full h-32 object-cover mt-2 rounded" onerror="this.style.display='none'">` : ''}
                  </div>
              `;

                // 创建信息窗口
                const infoWindow = new BMap.InfoWindow(infoContent, {
                    width: 320,
                    height: 0, // 自动调整高度
                    title: "" // 不显示默认标题栏
                });

                // 为标记添加点击事件
                marker.addEventListener("click", function(e) {
                    // 关闭之前打开的信息窗口
                    closeInfoWindow();

                    // 打开新的信息窗口
                    this.openInfoWindow(infoWindow);
                    currentInfoWindow = infoWindow;

                    // 阻止事件冒泡，防止触发地图点击事件
                    e.domEvent && e.domEvent.stopPropagation();
                });

                // 将标记添加到地图
                map.addOverlay(marker);
                // 将标记添加到数组中以便管理
                markers.push(marker);
            }
        });

        // 更新侧边栏
        updateSidebar();

        // 如果有搜索结果且只有一个结果，自动定位到该仪器
        if (filteredData.length === 1 && currentSearchTerm) {
            focusOnInstrument(0);
        } else if (filteredData.length > 1 && currentSearchTerm) {
            // 如果有多个搜索结果，调整地图视野以包含所有结果
            adjustMapViewToFitResults();
        }
    }

    /**
     * 调整地图视野以包含所有搜索结果
     */
    function adjustMapViewToFitResults() {
        if (filteredData.length === 0) return;

        const points = filteredData
            .filter(instrument => instrument.longitude && instrument.latitude)
            .map(instrument => new BMap.Point(parseFloat(instrument.longitude), parseFloat(instrument.latitude)));

        if (points.length > 0) {
            // 如果只有一个点，直接定位
            if (points.length === 1) {
                map.centerAndZoom(points[0], 15);
            } else {
                // 多个点时，调整视野以包含所有点
                map.setViewport(points);
            }
        }
    }

    /**
     * 高亮搜索关键词
     * @param {string} text - 原始文本
     * @param {string} searchTerm - 搜索关键词
     * @returns {string} 高亮后的HTML
     */
    function highlightSearchTerm(text, searchTerm) {
        if (!searchTerm || !text) return text;

        const regex = new RegExp(`(${searchTerm})`, 'gi');
        return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    /**
     * 清除所有地图标记
     */
    function clearMarkers() {
        markers.forEach(marker => {
            map.removeOverlay(marker);
        });
        markers = [];
        // 关闭信息窗口
        closeInfoWindow();
    }

    /**
     * 更新侧边栏内容
     */
    function updateSidebar() {
        const listContainer = document.getElementById('instrumentList');
        const totalCount = document.getElementById('totalCount');
        const shenzhenCount = document.getElementById('shenzhenCount');

        // 更新计数
        totalCount.textContent = filteredData.length;
        shenzhenCount.textContent = filteredData.length;

        // 获取当前页的数据
        const currentPageData = paginateData(filteredData, currentPage, itemsPerPage);

        // 添加页面切换动画
        listContainer.classList.add('page-transition');

        // 生成列表HTML
        listContainer.innerHTML = currentPageData.map((instrument, index) => {
            const globalIndex = (currentPage - 1) * itemsPerPage + index;
            return `
              <div class="p-4 hover:bg-gray-50 cursor-pointer transition-colors duration-200 instrument-item" onclick="focusOnInstrument(${globalIndex})">
                  <div class="flex items-start space-x-3">
                      <div class="flex-shrink-0">
                          <div class="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-bold">
                              ${globalIndex + 1}
                          </div>
                      </div>
                      <div class="flex-1 min-w-0">
                          <h4 class="text-sm font-medium text-red-600 hover:text-red-800 truncate">
                              ${highlightSearchTerm(instrument.instrName, currentSearchTerm)}
                          </h4>
                          <p class="text-sm text-gray-600 mt-1">${highlightSearchTerm(instrument.companyName, currentSearchTerm)}</p>
                          <div class="flex items-center text-xs text-gray-500 mt-1">
                              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                              </svg>
                              ${instrument.address}
                          </div>
                          <div class="flex items-center justify-between mt-2">
                              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                  ${highlightSearchTerm(instrument.instrSort, currentSearchTerm)}
                              </span>
                              <span class="text-xs text-gray-500">${instrument.placeProduce}</span>
                          </div>
                      </div>
                  </div>
              </div>
          `;
        }).join('');

        // 更新分页控件
        updatePaginationMobile();

        // 移除动画类
        setTimeout(() => {
            listContainer.classList.remove('page-transition');
        }, 400);
    }

    /**
     * 更新增强的分页控件
     */
    function updatePaginationMobile() {
        const totalPages = getTotalPages(filteredData, itemsPerPage);
        const paginationContainer = document.querySelector('.pagination-wrapper');

        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(currentPage * itemsPerPage, filteredData.length);

        let paginationHTML = `
      <div class="flex flex-col items-center justify-between gap-4">
          <div class="pagination-info">
              第 <span class="font-semibold text-red-600">${startItem}</span>-<span class="font-semibold text-red-600">${endItem}</span> 条，
              共 <span class="font-semibold text-red-600">${filteredData.length}</span> 条
              ${totalPages > 1 ? `，第 <span class="font-semibold text-red-600">${currentPage}</span>/<span class="font-semibold text-red-600">${totalPages}</span> 页` : ''}
          </div>
  `;

        // 只有当总页数大于1时才显示分页按钮
        if (totalPages > 1) {
            paginationHTML += `
          <div class="flex items-center gap-1 pagination-controls">
      `;

            // 移动端简化分页逻辑
            if (isMobile()) {
                // 上一页按钮
                paginationHTML += `
              <button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === 1 ? '' : 'hover:shadow-lg'}"
                      title="上一页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
              </button>
          `;

                // 显示当前页和相邻页码
                const startPage = Math.max(1, currentPage - 1);
                const endPage = Math.min(totalPages, currentPage + 1);

                for (let i = startPage; i <= endPage; i++) {
                    const isActive = i === currentPage;
                    paginationHTML += `
                  <button onclick="goToPage(${i})"
                          class="pagination-btn ${isActive ? 'pagination-btn-active' : 'pagination-btn-default hover:shadow-lg'}"
                          title="第${i}页">
                      ${i}
                  </button>
              `;
                }

                // 如果不是最后几页，显示跳转到最后页
                if (currentPage < totalPages - 1) {
                    paginationHTML += `
                  <span class="px-1 text-gray-400 text-sm">...</span>
                  <button onclick="goToPage(${totalPages})" class="pagination-btn pagination-btn-default hover:shadow-lg">${totalPages}</button>
              `;
                }

                // 下一页按钮
                paginationHTML += `
              <button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === totalPages ? '' : 'hover:shadow-lg'}"
                      title="下一页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
              </button>
          `;
            } else {
                // 桌面端完整分页逻辑（保持原有逻辑）
                // 首页按钮
                paginationHTML += `
              <button onclick="goToPage(1)" ${currentPage === 1 ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === 1 ? '' : 'hover:shadow-lg'}"
                      title="首页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                  </svg>
              </button>
          `;

                // 上一页按钮
                paginationHTML += `
              <button onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === 1 ? '' : 'hover:shadow-lg'}"
                      title="上一页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
              </button>
          `;

                // 页码按钮
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);

                // 如果开始页码大于1，显示省略号
                if (startPage > 1) {
                    paginationHTML += `
                  <button onclick="goToPage(1)" class="pagination-btn pagination-btn-default hover:shadow-lg">1</button>
              `;
                    if (startPage > 2) {
                        paginationHTML += `<span class="px-2 text-gray-400">...</span>`;
                    }
                }

                // 显示页码按钮
                for (let i = startPage; i <= endPage; i++) {
                    const isActive = i === currentPage;
                    paginationHTML += `
                  <button onclick="goToPage(${i})"
                          class="pagination-btn ${isActive ? 'pagination-btn-active' : 'pagination-btn-default hover:shadow-lg'} ${isActive ? 'pagination-number-bounce' : ''}"
                          title="第${i}页">
                      ${i}
                  </button>
              `;
                }

                // 如果结束页码小于总页数，显示省略号
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        paginationHTML += `<span class="px-2 text-gray-400">...</span>`;
                    }
                    paginationHTML += `
                  <button onclick="goToPage(${totalPages})" class="pagination-btn pagination-btn-default hover:shadow-lg">${totalPages}</button>
              `;
                }

                // 下一页按钮
                paginationHTML += `
              <button onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === totalPages ? '' : 'hover:shadow-lg'}"
                      title="下一页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
              </button>
          `;

                // 尾页按钮
                paginationHTML += `
              <button onclick="goToPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}
                      class="pagination-btn pagination-btn-default ${currentPage === totalPages ? '' : 'hover:shadow-lg'}"
                      title="尾页">
                  <svg class="w-4 h-4 pagination-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                  </svg>
              </button>
          `;
            }

            paginationHTML += `
          </div>
      `;
        }

        paginationHTML += `
      </div>
  `;

        paginationContainer.innerHTML = paginationHTML;
    }

    /**
     * 跳转到指定页面（增强版）
     * @param {number} page - 目标页码
     */
    function goToPage(page) {
        const totalPages = getTotalPages(filteredData, itemsPerPage);
        if (page >= 1 && page <= totalPages && page !== currentPage && !isPageLoading) {
            // 设置加载状态
            isPageLoading = true;

            // 添加加载效果
            const paginationBtns = document.querySelectorAll('.pagination-btn');
            paginationBtns.forEach(btn => {
                if (!btn.disabled) {
                    btn.classList.add('pagination-loading');
                }
            });

            // 模拟加载延迟，实际项目中可能是API调用
            setTimeout(() => {
                currentPage = page;
                updateSidebar();

                // 移除加载状态
                isPageLoading = false;

                // 滚动到列表顶部
                document.getElementById('instrumentList').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);
        }
    }

    /**
     * 聚焦到指定仪器
     * @param {number} index - 仪器在过滤数据中的索引
     */
    function focusOnInstrument(index) {
        const instrument = filteredData[index];
        if (instrument.longitude && instrument.latitude) {
            const point = new BMap.Point(parseFloat(instrument.longitude), parseFloat(instrument.latitude));
            // 将地图中心移动到该仪器位置，并设置合适的缩放级别
            map.centerAndZoom(point, 15);

            // 触发对应标记的点击事件，显示信息窗口
            if (markers[index]) {
                // 延迟触发点击事件，确保地图移动完成
                setTimeout(() => {
                    // 创建一个模拟的点击事件
                    const clickEvent = {
                        domEvent: {
                            stopPropagation: function() {}
                        }
                    };
                    markers[index].dispatchEvent('click', clickEvent);
                }, 500);
            }
        }
    }

    /**
     * 搜索仪器功能
     */
    function searchInstruments() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
        const searchStatus = document.getElementById('searchStatus');
        const searchInfo = document.getElementById('searchInfo');
        const searchTermSpan = document.getElementById('searchTerm');

        // 显示搜索状态
        if (searchTerm) {
            searchStatus.classList.remove('hidden');
        }

        // 模拟搜索延迟（实际项目中可能是API调用）
        setTimeout(() => {
            currentSearchTerm = searchTerm;

            if (searchTerm === '') {
                // 如果搜索词为空，显示所有数据
                filteredData = instrumentsData;
                searchInfo.classList.add('hidden');
            } else {
                // 根据搜索词过滤数据
                filteredData = instrumentsData.filter(instrument =>
                    instrument.instrName.toLowerCase().includes(searchTerm) ||
                    instrument.companyName.toLowerCase().includes(searchTerm) ||
                    instrument.city.toLowerCase().includes(searchTerm) ||
                    instrument.province.toLowerCase().includes(searchTerm) ||
                    instrument.instrSort.toLowerCase().includes(searchTerm) ||
                    instrument.address.toLowerCase().includes(searchTerm)
                );

                // 显示搜索信息
                searchInfo.classList.remove('hidden');
                searchTermSpan.textContent = document.getElementById('searchInput').value;
            }

            // 重置到第一页
            currentPage = 1;

            // 重新加载仪器到地图
            loadInstruments();

            // 隐藏搜索状态
            searchStatus.classList.add('hidden');

            // 如果没有搜索结果，显示提示
            if (filteredData.length === 0 && searchTerm) {
                showNoResultsMessage();
            }
        }, 800);
    }

    /**
     * 清除搜索
     */
    function clearSearch() {
        document.getElementById('searchInput').value = '';
        currentSearchTerm = '';
        filteredData = instrumentsData;
        currentPage = 1;

        // 隐藏搜索信息
        document.getElementById('searchInfo').classList.add('hidden');

        // 重新加载所有仪器
        loadInstruments();

        // 重置地图视野到深圳市
        map.centerAndZoom(new BMap.Point(114.057868, 22.543099), 10);
    }

    /**
     * 显示无搜索结果消息
     */
    function showNoResultsMessage() {
        const listContainer = document.getElementById('instrumentList');
        listContainer.innerHTML = `
          <div class="p-8 text-center text-gray-500 no-results">
              <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.562M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
              </svg>
              <h3 class="text-lg font-medium mb-2">未找到相关仪器</h3>
              <p class="text-sm">请尝试使用其他关键词搜索</p>
              <button onclick="clearSearch()" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors duration-200">
                  清除搜索条件
              </button>
          </div>
      `;

        // 清空分页
        document.querySelector('.pagination-wrapper').innerHTML = '';
    }

    // 为搜索输入框添加回车键支持
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchInstruments();
        }
    });

    // 为搜索输入框添加实时搜索支持（可选）
    document.getElementById('searchInput').addEventListener('input', function(e) {
        // 防抖处理，避免频繁搜索
        clearTimeout(this.searchTimeout);
        this.searchTimeout = setTimeout(() => {
            if (e.target.value.trim() === '') {
                clearSearch();
            }
        }, 500);
    });

    // 移动端菜单切换功能
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        mobileMenu.classList.toggle('hidden');
    }

    // 检测是否为移动设备
    function isMobile() {
        return window.innerWidth <= 768;
    }

    // 窗口大小改变时重新渲染分页
    window.addEventListener('resize', function() {
        updatePaginationMobile();

        // 如果窗口大小改变，重新调整地图大小
        if (map) {
            setTimeout(() => {
                map.checkResize();
            }, 100);
        }
    });

    // 页面加载完成后初始化地图
    window.onload = function() {
        initMap();
    };
</script>
</body>
</html>
